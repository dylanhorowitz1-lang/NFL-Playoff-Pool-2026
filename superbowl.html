<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Super Bowl Predictions</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#111a33;
      --card2:#0f1730;
      --text:#e8ecff;
      --muted:#a9b3da;
      --accent:#5eead4;
      --border: rgba(255,255,255,.12);
      --shadow: 0 12px 30px rgba(0,0,0,.35);
      --grid: rgba(255,255,255,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: radial-gradient(1200px 500px at 20% -10%, rgba(94,234,212,.18), transparent 60%),
                  radial-gradient(900px 500px at 100% 0%, rgba(99,102,241,.22), transparent 55%),
                  var(--bg);
      color:var(--text);
      min-height:100vh;
    }
    .wrap{max-width:1200px;margin:0 auto;padding:28px 16px 44px}
    .top{
      display:flex;align-items:flex-start;justify-content:space-between;gap:16px;flex-wrap:wrap;
      padding:18px 18px 10px;border:1px solid var(--border);border-radius:18px;background:rgba(17,26,51,.55);
      box-shadow: var(--shadow); backdrop-filter: blur(10px);
    }
    h1{margin:0;font-size:28px;letter-spacing:.2px}
    .sub{margin:6px 0 0;color:var(--muted);max-width:860px;line-height:1.45}
    .nav{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;}
    .btn{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:12px;border:1px solid var(--border);
      background: rgba(15,23,48,.65);color:var(--text);text-decoration:none;
      transition: transform .12s ease, border-color .12s ease;
    }
    .btn:hover{transform: translateY(-1px);border-color: rgba(94,234,212,.45)}
    .card{
      margin-top:18px;border:1px solid var(--border);border-radius:18px;
      background: linear-gradient(180deg, rgba(17,26,51,.75), rgba(15,23,48,.65));
      box-shadow: var(--shadow);padding:14px;overflow-x:auto;
    }

    /* Tables */
    table{
      border-collapse: collapse;
      width: 100%;
      min-width: 900px;
      table-layout: fixed;
    }
    th, td{
      border: 1px solid var(--grid);
      padding: 7px 8px;
      text-align: center;
      vertical-align: middle;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-size: 13px;
    }
    thead th{
      position: sticky;
      top: 0;
      background: rgba(15,23,48,.95);
      z-index: 2;
    }
    th.name, td.name{
      text-align:left;
      font-weight: 700;
      width: 220px;
    }

    /* Wild Card Picks colors (same classes) */
    .pending { background: transparent; }
    .correct { background: #1f6f4a; }   /* green */
    .wrong   { background: #7a2b3a; }   /* red */
    .push    { background: #6b5b1f; }   /* yellow */

    /* Extra: eliminated team text (NO STRIKETHROUGH) */
    .eliminated{
      color: #ff7b92;
      text-decoration: none;
      font-weight: 800;
    }

    /* NEW: eliminated cell styling (whole cell turns red) */
    .elimCell{
      background: #7a2b3a !important; /* same red as .wrong */
      color: var(--text);
      font-weight: 800;
      text-decoration: none;
    }

    /* Results row styling */
    .actualRow th, .actualRow td{
      background: rgba(15,23,48,.70);
      font-weight: 800;
      color: var(--muted);
    }
    .actualRow .label{
      color: var(--text);
      font-weight: 900;
    }

    .sectionTitle{
      margin: 0 0 10px 0;
      font-size: 16px;
      color: var(--text);
      letter-spacing: .2px;
    }

    #msg { color: var(--muted); font-size: 12px; margin-top: 10px; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>Super Bowl Predictions</h1>
        <p class="sub">Picks load from <b>superbowl_predictions.csv</b>. This page also highlights eliminated teams.</p>
        <div class="nav">
          <a class="btn" href="index.html">Home</a>
          <a class="btn" href="wildcard.html">Wild Card Picks</a>
          <a class="btn" href="standings.html">Standings</a>
        </div>
      </div>
      <div class="pill">Manual refresh</div>
    </div>

    <div id="msg"></div>

    <div class="card">
      <table id="predTable">
        <thead id="thead"></thead>
        <tbody id="tbody"></tbody>
      </table>
    </div>

    <div class="card">
      <div class="sectionTitle">Pick Distribution</div>
      <table id="distTable">
        <thead>
          <tr>
            <th class="name">Team</th>
            <th>AFC Champion</th>
            <th>NFC Champion</th>
            <th>Super Bowl Champion</th>
          </tr>
        </thead>
        <tbody id="distBody"></tbody>
      </table>
    </div>
  </div>

<script>
(() => {
  "use strict";

  // =========================
  // YOU EDIT THESE TWO LISTS
  // =========================

  // 1) Seed order list (14 teams) EXACTLY as ESPN/team names appear in your CSV.
  const SEED_ORDER = [
      "Denver Broncos", "New England Patriots", "Jacksonville Jaguars", "Pittsburgh Steelers", "Houston Texans", "Buffalo Bills", "Los Angeles Chargers",
      "Seattle Seahawks", "Chicago Bears", "Philadelphia Eagles", "Carolina Panthers", "Los Angeles Rams", "San Francisco 49ers", "Green Bay Packers"
  ];

  // 2) Eliminated teams list — add team names here as they get eliminated.
  const ELIMINATED_TEAMS = [
      "Jacksonville Jaguars", "Pittsburgh Steelers", "Los Angeles Chargers", "Philadelphia Eagles", "Carolina Panthers", "Green Bay Packers"
  ];

  // --- Normalization + set for strict matching
  function normalizeTeamName(s){
    return String(s || "").replace(/\u00A0/g," ").trim().toLowerCase();
  }
  const ELIMINATED_SET = new Set(ELIMINATED_TEAMS.map(normalizeTeamName));

  function isEliminated(teamName) {
    const key = normalizeTeamName(teamName);
    if (!key) return false;
    if (key === "tbd") return false;
    if (ELIMINATED_SET.size === 0) return false;
    return ELIMINATED_SET.has(key);
  }

  // =========================
  // RESULTS (TBD now)
  // Fill these in later when known
  // =========================
  const ACTUAL = {
    afc: "",   // e.g. "Kansas City Chiefs"
    nfc: "",   // e.g. "Detroit Lions"
    sb:  ""    // e.g. "Kansas City Chiefs"
  };

  // CSV file
  const CSV_PATH = "superbowl_predictions.csv";

  const msgEl = document.getElementById("msg");
  const theadEl = document.getElementById("thead");
  const tbodyEl = document.getElementById("tbody");
  const distBodyEl = document.getElementById("distBody");

  function norm(s){ return String(s || "").trim().toLowerCase(); }

  function splitCSVLine(line) {
    const out = [];
    let cur = "", inQ = false;
    for (let i = 0; i < line.length; i++) {
      const ch = line[i];
      if (ch === '"') {
        if (inQ && line[i+1] === '"') { cur += '"'; i++; }
        else inQ = !inQ;
      } else if (ch === ',' && !inQ) {
        out.push(cur); cur = "";
      } else cur += ch;
    }
    out.push(cur);
    return out.map(x => x.trim());
  }

  function parseCSV(text) {
    const lines = text.replace(/\r/g, "").split("\n").filter(l => l.trim() !== "");
    if (lines.length < 2) return [];
    const headers = splitCSVLine(lines[0]);
    return lines.slice(1).map(line => {
      const cols = splitCSVLine(line);
      const obj = {};
      headers.forEach((h, i) => obj[h] = (cols[i] ?? ""));
      return obj;
    });
  }

  async function fetchTextOrNull(path) {
    try {
      const r = await fetch(path, { cache: "no-store" });
      if (!r.ok) return null;
      return await r.text();
    } catch (e) { return null; }
  }

  // Team rendering for distribution table (text only)
  function renderTeam(teamName) {
    const t = String(teamName || "").trim();
    if (!t || t.toUpperCase() === "TBD") return t; // never style TBD
    return isEliminated(t) ? `<span class="eliminated">${t}</span>` : t;
  }

  // UPDATED: adds elimCell class so the WHOLE TD turns red
  function fmtPickCell(teamName, correctTeamName) {
    const t = String(teamName || "").trim();
    if (!t) return { html: "", cls: "pending" };

    const elim = isEliminated(t);
    const extra = elim ? " elimCell" : "";

    // correct highlighting only if correctTeamName is set
    if (correctTeamName && norm(t) === norm(correctTeamName)) {
      return { html: t, cls: "correct" + extra };
    }

    // if correctTeamName is set and pick is different => wrong
    if (correctTeamName) {
      return { html: t, cls: "wrong" + extra };
    }

    // otherwise pending
    return { html: t, cls: "pending" + extra };
  }

  function fmtCount(n){
    const x = Number(n);
    return (!Number.isFinite(x) || x === 0) ? "-" : String(x);
  }

  function buildHeader() {
    const afcTxt = ACTUAL.afc ? ACTUAL.afc : "TBD";
    const nfcTxt = ACTUAL.nfc ? ACTUAL.nfc : "TBD";
    const sbTxt  = ACTUAL.sb  ? ACTUAL.sb  : "TBD";

    const rowActual = `
      <tr class="actualRow">
        <th class="name label">Results</th>
        <td>${afcTxt}</td>
        <td>${nfcTxt}</td>
        <td>${sbTxt}</td>
      </tr>
    `;

    const rowCols = `
      <tr>
        <th class="name">Entrant</th>
        <th>AFC Champion</th>
        <th>NFC Champion</th>
        <th>Super Bowl Champion</th>
      </tr>
    `;

    theadEl.innerHTML = rowActual + rowCols;
  }

  function renderRows(rows) {
    tbodyEl.innerHTML = "";

    rows
      .filter(r => String(r.Name || "").trim() !== "")
      .forEach(r => {
        const name = String(r.Name || "").trim();

        const afcPick = String(r.AFCChampion || r["AFC Champion"] || "").trim();
        const nfcPick = String(r.NFCChampion || r["NFC Champion"] || "").trim();
        const sbPick  = String(r.SuperBowlChampion || r["Super Bowl Champion"] || r.SBChampion || "").trim();

        const afcCell = fmtPickCell(afcPick, ACTUAL.afc);
        const nfcCell = fmtPickCell(nfcPick, ACTUAL.nfc);
        const sbCell  = fmtPickCell(sbPick,  ACTUAL.sb);

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="name">${name}</td>
          <td class="${afcCell.cls}">${afcCell.html}</td>
          <td class="${nfcCell.cls}">${nfcCell.html}</td>
          <td class="${sbCell.cls}">${sbCell.html}</td>
        `;
        tbodyEl.appendChild(tr);
      });
  }

  function buildDistribution(rows) {
    const counts = new Map(); // team -> {afc,nfc,sb}

    function ensure(team) {
      if (!counts.has(team)) counts.set(team, { afc:0, nfc:0, sb:0 });
      return counts.get(team);
    }

    rows
      .filter(r => String(r.Name || "").trim() !== "")
      .forEach(r => {
        const afcPick = String(r.AFCChampion || r["AFC Champion"] || "").trim();
        const nfcPick = String(r.NFCChampion || r["NFC Champion"] || "").trim();
        const sbPick  = String(r.SuperBowlChampion || r["Super Bowl Champion"] || r.SBChampion || "").trim();

        if (afcPick) ensure(afcPick).afc++;
        if (nfcPick) ensure(nfcPick).nfc++;
        if (sbPick)  ensure(sbPick).sb++;
      });

    const teams = (SEED_ORDER && SEED_ORDER.length)
      ? SEED_ORDER.slice()
      : Array.from(counts.keys()).sort((a,b) => a.localeCompare(b));

    distBodyEl.innerHTML = "";
    teams.forEach(team => {
      const c = counts.get(team) || { afc:0, nfc:0, sb:0 };

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td class="name">${renderTeam(team)}</td>
        <td>${fmtCount(c.afc)}</td>
        <td>${fmtCount(c.nfc)}</td>
        <td>${fmtCount(c.sb)}</td>
      `;
      distBodyEl.appendChild(tr);
    });
  }

  async function main() {
    msgEl.textContent = "Loading…";
    buildHeader();

    const text = await fetchTextOrNull(CSV_PATH);
    if (!text) {
      msgEl.textContent = "Missing superbowl_predictions.csv";
      tbodyEl.innerHTML = "";
      distBodyEl.innerHTML = "";
      return;
    }

    const rows = parseCSV(text);

    renderRows(rows);
    buildDistribution(rows);

    if (!SEED_ORDER.length) {
      msgEl.textContent = "Loaded superbowl_predictions.csv. (Optional) Add SEED_ORDER list for Pick Distribution ordering.";
    } else {
      msgEl.textContent = "Loaded superbowl_predictions.csv.";
    }
  }

  main().catch(err => {
    console.error(err);
    msgEl.textContent = "Could not load Super Bowl predictions right now.";
  });

})();
</script>

</body>
</html>
