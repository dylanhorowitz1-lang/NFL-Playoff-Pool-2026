<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wild Card Picks</title>

<style>
:root{
  --bg:#0b1020;
  --card:#111a33;
  --text:#e8ecff;
  --muted:#a9b3da;
  --border: rgba(255,255,255,.15);
  --sep: rgba(255,255,255,.45);
}
*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  background: var(--bg);
  color:var(--text);
}

.wrap{max-width:1400px;margin:auto;padding:24px}
.card{
  background:#111a33;
  border-radius:16px;
  padding:14px;
  overflow-x:auto;
}

/* TABLE */
table{
  border-collapse:collapse;
  width:100%;
  min-width:1500px; /* force width so names fit */
  table-layout:auto; /* allow columns to grow */
}
th,td{
  border:1px solid var(--border);
  padding:8px 10px;
  text-align:center;
  white-space:nowrap;   /* keep team names on one line */
  font-size:14px;
}
th{
  background:#0f1730;
}
td.name, th.name{
  text-align:left;
  font-weight:700;
  min-width:180px;
}

/* stronger separators between games */
.sep{
  border-right:3px solid var(--sep)!important;
}

/* states */
.pending{background:#2a3357}
.correct{background:#1f6f4a}
.wrong{background:#7a2b3a}
.push{background:#6b5b1f}

.correct-label{
  font-weight:700;
  color:var(--muted);
  text-align:left;
  background:#0f1730;
}

#msg{font-size:12px;color:var(--muted);margin:10px 0}
</style>
</head>

<body>
<div class="wrap">
  <h1>Wild Card Picks</h1>
  <div id="msg"></div>

  <div class="card">
    <table>
      <thead id="thead"></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<script>
/* ------------------ CONFIG ------------------ */
const SCOREBOARD_URLS=[
 "https://api.codetabs.com/v1/proxy/?quest="+encodeURIComponent(
  "https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard"
 )
];

/* ------------------ HELPERS ------------------ */
const norm=s=>String(s||"").trim().toLowerCase();

async function fetchJson(u){
 for(const x of u){
  try{
   const r=await fetch(x,{cache:"no-store"});
   if(r.ok) return await r.json();
  }catch{}
 }
 throw "fetch fail";
}

async function fetchText(p){
 try{
  const r=await fetch(p,{cache:"no-store"});
  if(!r.ok) return null;
  return await r.text();
 }catch{return null}
}

function parseCSV(t){
 const l=t.replace(/\r/g,"").split("\n").filter(Boolean);
 const h=l[0].split(",");
 return l.slice(1).map(r=>{
  const o={}; r.split(",").forEach((v,i)=>o[h[i]]=v.trim());
  return o;
 });
}

function eventInfo(ev){
 const c=ev.competitions[0];
 const t=c.competitors;
 const a=t.find(x=>x.homeAway==="away");
 const h=t.find(x=>x.homeAway==="home");
 return{
  away:a.team.displayName,
  home:h.team.displayName,
  aScore:+a.score,
  hScore:+h.score,
  final:c.status.type.completed,
  winner:t.find(x=>x.winner)?.team.displayName||""
 };
}

function atsWinner(i,s){
 const m=(i.hScore+s)-i.aScore;
 if(m>0) return i.home;
 if(m<0) return i.away;
 return "Push";
}

function ouRes(i,t){
 const sum=i.hScore+i.aScore;
 if(sum>t) return "Over";
 if(sum<t) return "Under";
 return "Push";
}

/* ------------------ BUILD HEADERS ------------------ */
function buildHeaders(matchups){
 let r1=`<tr><th class="name" rowspan="4">Name</th>`;
 matchups.forEach((m,i)=>r1+=`<th colspan="3"${i<5?' class="sep"':''}>${m}</th>`);
 r1+=`</tr>`;

 let r2=`<tr>`;
 matchups.forEach((_,i)=>r2+=`<th>Adv</th><th>Spread</th><th class="sep">O/U</th>`);
 r2+=`</tr>`;

 let r3=`<tr>
   <td class="correct-label">Correct Picks</td>`;
 for(let i=1;i<=6;i++){
  r3+=`<td id="res_adv_${i}" class="pending">TBD</td>
        <td id="res_ats_${i}" class="pending">TBD</td>
        <td id="res_ou_${i}" class="pending sep">TBD</td>`;
 }
 r3+=`</tr>`;

 thead.innerHTML=r1+r2+r3;
}

/* ------------------ MAIN ------------------ */
(async()=>{
 const msg=document.getElementById("msg");
 const tbody=document.getElementById("tbody");

 const picksText=await fetchText("wildcard_picks.csv");
 const linesText=await fetchText("lines.csv");
 if(!picksText||!linesText){msg.textContent="Missing CSV files";return}

 const picks=parseCSV(picksText);
 const lines=parseCSV(linesText);
 const lineMap=new Map(lines.map(r=>[r.GameID,{s:+r.HomeSpread,t:+r.Total}]));

 const data=await fetchJson(SCOREBOARD_URLS);
 const events=new Map();
 data.events.forEach(e=>events.set(e.id,e));

 const gameIds=Array.from(lineMap.keys()).slice(0,6);
 const matchups=gameIds.map(id=>{
  const ev=events.get(id);
  if(!ev) return "Game";
  const i=eventInfo(ev);
  return `${i.away} @ ${i.home}`;
 });

 buildHeaders(matchups);

 picks.forEach(r=>{
  const tr=document.createElement("tr");
  tr.innerHTML=`<td class="name">${r.Name}</td>`;
  gameIds.forEach((gid,i)=>{
   const ev=events.get(gid);
   const line=lineMap.get(gid);
   const adv=r[`PickAdvancing${i+1}`];
   const ats=r[`PickATS${i+1}`];
   const ou=r[`Pick OU${i+1}`];

   let ac="pending",sc="pending",oc="pending";
   if(ev){
    const info=eventInfo(ev);
    if(info.final){
     if(norm(adv)===norm(info.winner)) ac="correct"; else ac="wrong";
     const aw=atsWinner(info,line.s);
     if(aw!=="Push") sc=norm(ats)===norm(aw)?"correct":"wrong";
     const o=ouRes(info,line.t);
     if(o!=="Push") oc=norm(ou)===norm(o)?"correct":"wrong";
    }
   }

   tr.innerHTML+=`
    <td class="${ac}">${adv}</td>
    <td class="${sc}">${ats}</td>
    <td class="${oc} sep">${ou}</td>`;
  });
  tbody.appendChild(tr);
 });

 msg.textContent="Loaded Wild Card Picks";
})();
</script>
</body>
</html>

